---
phase: 02-ux-improvements
plan: 02-03
type: execute
---

<objective>
Convert Salesforce Lead IDs to clickable links in KPIs Recent Enrichments table and filter out "Unknown" lead source from Dashboard statistics.

Purpose: Improve navigation by allowing users to click Lead IDs to open Salesforce records directly, and reduce noise in dashboard statistics by excluding unknown/invalid lead sources.
Output: Lead IDs in KPIs table become clickable links to Salesforce, "Unknown" lead source excluded from Dashboard by-source statistics and chart
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/STRUCTURE.md
@.planning/phases/02-ux-improvements/02-01-SUMMARY.md
@.planning/phases/02-ux-improvements/02-02-SUMMARY.md
@public/index.html

**Established patterns:**
- Unenriched leads table (line 1977): Lead IDs as clickable links to Salesforce Lightning
- Link format: `https://townsquaremedia.lightning.force.com/lightning/r/Lead/${lead.id}/view`
- Link styling: `target="_blank" style="font-family: monospace; font-size: 11px;"`

**Current state:**
- KPIs Recent Enrichments (line 1477): Lead IDs shown as plain `<code>` elements
- Dashboard by-source stats (lines 1069-1089): Displays ALL lead sources including "Unknown"
- Lead source chart (line 1147): Uses leadSource values directly from byLeadSource array

**Constraining decisions:**
- Phase 1: Preserve monolithic architecture (no refactoring, incremental improvements only)
- Use existing clickable link pattern from unenriched leads view
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert Lead IDs to clickable links in KPIs Recent Enrichments table</name>
  <files>public/index.html</files>
  <action>
In the renderKPIs() function, find the Recent Enrichments table row template (line 1477) and replace the plain code element:

**Current (line 1477):**
```javascript
<td><code style="font-size: 11px;">${e.salesforce_lead_id}</code></td>
```

**Replace with:**
```javascript
<td><a href="https://townsquaremedia.lightning.force.com/lightning/r/Lead/${e.salesforce_lead_id}/view" target="_blank" style="font-family: monospace; font-size: 11px;">${e.salesforce_lead_id}</a></td>
```

This matches the exact pattern used in unenriched leads table (line 1977). Do NOT change anything else in the table - only this one cell.
  </action>
  <verify>
Grep for the updated link: `grep -n "townsquaremedia.lightning.force.com.*salesforce_lead_id" public/index.html`
Should show the link in KPIs Recent Enrichments table (around line 1477).
  </verify>
  <done>Lead IDs in KPIs Recent Enrichments are clickable links to Salesforce Lightning</done>
</task>

<task type="auto">
  <name>Task 2: Filter "Unknown" lead source from Dashboard statistics and chart</name>
  <files>public/index.html</files>
  <action>
In the renderDashboard() function, filter out "Unknown" lead sources BEFORE rendering statistics.

**Find the byLeadSource rendering code (around line 1069):**
```javascript
${stats.byLeadSource.slice(0, 10).map(source => `
```

**Replace with:**
```javascript
${stats.byLeadSource.filter(s => s.leadSource && s.leadSource.toLowerCase() !== 'unknown').slice(0, 10).map(source => `
```

**Then find the renderSourceChart() call (around line 1089):**
```javascript
renderSourceChart(stats.byLeadSource);
```

**Replace with:**
```javascript
renderSourceChart(stats.byLeadSource.filter(s => s.leadSource && s.leadSource.toLowerCase() !== 'unknown'));
```

This will:
1. Remove "Unknown" lead sources from the by-source statistics table
2. Remove "Unknown" from the lead source doughnut chart
3. Handle both "Unknown" and null/empty lead sources (the `s.leadSource &&` check)

Do NOT modify the backend - filtering happens client-side in the UI.
  </action>
  <verify>
Grep for the filter logic: `grep -n "leadSource.toLowerCase.*unknown" public/index.html`
Should show two instances: one in the table rendering, one in the chart call.
  </verify>
  <done>"Unknown" lead source filtered from Dashboard table and chart, null/empty sources also excluded</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Clickable Lead ID links in KPIs table and filtered "Unknown" lead sources from Dashboard</what-built>
  <how-to-verify>
    1. Run: `npm run dev` (if not already running)
    2. Visit: http://localhost:4900/dashboard
    3. Test KPIs Lead ID Links:
       - Navigate to KPIs tab
       - Verify Lead IDs in Recent Enrichments table are blue/underlined (clickable links)
       - Click a Lead ID link
       - Verify Salesforce opens in new tab showing the correct Lead record
       - Verify link format matches: `https://townsquaremedia.lightning.force.com/lightning/r/Lead/{ID}/view`
    4. Test Dashboard "Unknown" Filtering:
       - Navigate to Dashboard tab
       - Check "Leads by Source" table (should be 10 rows)
       - Verify NO rows show "Unknown" as the lead source
       - Check the lead source doughnut chart
       - Verify NO "Unknown" segment in the chart
       - If you previously had "Unknown" sources, verify the counts/percentages recalculated correctly
    5. Verify no console errors
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Lead IDs in KPIs Recent Enrichments are clickable links
- [ ] Links open correct Salesforce Lead records in new tab
- [ ] "Unknown" lead source filtered from Dashboard statistics table
- [ ] "Unknown" lead source filtered from Dashboard source chart
- [ ] Null/empty lead sources also excluded
- [ ] No console errors introduced
- [ ] User verified both changes work correctly
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Lead IDs navigate to Salesforce correctly
- "Unknown" lead sources hidden from Dashboard view
- No errors introduced
- User has visually verified both improvements
- Phase 2 complete (all 3 plans finished)
</success_criteria>

<output>
After completion, create `.planning/phases/02-ux-improvements/02-03-SUMMARY.md`:

---
phase: 02-ux-improvements
plan: 02-03
subsystem: dashboard-ui
requires:
  - 02-01
  - 02-02
provides:
  - Clickable Lead ID pattern for KPIs
  - Lead source filtering pattern
affects: []
tags:
  - ui-navigation
  - data-filtering
key-decisions:
  - Reused Salesforce Lightning link pattern from unenriched leads view
  - Implemented client-side filtering for "Unknown" lead sources (no backend changes)
  - Filter handles both "Unknown" string and null/empty values
key-files:
  - public/index.html
tech-stack:
  added: []
  patterns:
    - Clickable Salesforce Lead ID links in dashboard tables
    - Client-side filtering for invalid/unknown data
patterns-established:
  - Lead ID link format: `https://townsquaremedia.lightning.force.com/lightning/r/Lead/{ID}/view`
  - Case-insensitive string filtering with null checks
next-phase-readiness:
  - Phase 2 complete - all UX improvements implemented
  - Ready to start Phase 3: Manual Enrichment Enhancement
---

# Phase 2 Plan 3: Lead ID Links and Unknown Source Filter Summary

**Improved dashboard navigation with clickable Lead IDs and cleaner statistics by filtering invalid lead sources**

## Accomplishments

- Converted Lead IDs in KPIs Recent Enrichments table to clickable Salesforce Lightning links
- Filtered "Unknown" lead sources from Dashboard by-source statistics table (top 10 display)
- Filtered "Unknown" lead sources from Dashboard source doughnut chart
- Implemented null/empty lead source filtering as bonus improvement

## Files Created/Modified

- [public/index.html](public/index.html) - Updated KPIs Lead ID rendering and Dashboard source filtering

## Decisions Made

- Reused exact link pattern from unenriched leads view for consistency
- Chose client-side filtering over backend changes (simpler, no API modification needed)
- Added null check (`s.leadSource &&`) to handle missing lead sources gracefully

## Issues Encountered

None

## Verification

- User confirmed Lead ID links navigate to correct Salesforce records
- User verified "Unknown" lead sources no longer appear in Dashboard table or chart
- User verified statistics recalculated correctly without "Unknown" sources

## Next Step

Phase 2 complete! Ready for Phase 3: Manual Enrichment Enhancement
</output>
